if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0){from+=len}for(;from<len;from++){if(from in this&&this[from]===elt){return from}}return -1}}var goog=goog||{};goog.DEBUG=false;goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor();childCtor.prototype.constructor=childCtor};if(!goog.userAgent){goog.userAgent=(function(){var userAgent="";if("undefined"!==typeof navigator&&navigator&&"string"==typeof navigator.userAgent){userAgent=navigator.userAgent}var isOpera=userAgent.indexOf("Opera")==0;return{jscript:{HAS_JSCRIPT:"ScriptEngine" in this},OPERA:isOpera,IE:!isOpera&&userAgent.indexOf("MSIE")!=-1,WEBKIT:!isOpera&&userAgent.indexOf("WebKit")!=-1}})()}if(!goog.asserts){goog.asserts={assert:function(condition){if(!condition){throw Error("Assertion error")}},fail:function(var_args){}}}if(!goog.dom){goog.dom={};goog.dom.DomHelper=function(d){this.document_=d||document};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};goog.dom.DomHelper.prototype.createElement=function(name){return this.document_.createElement(name)};goog.dom.DomHelper.prototype.createDocumentFragment=function(){return this.document_.createDocumentFragment()}}if(!goog.format){goog.format={insertWordBreaks:function(str,maxCharsBetweenWordBreaks){str=String(str);var resultArr=[];var resultArrLen=0;var isInTag=false;var isMaybeInEntity=false;var numCharsWithoutBreak=0;var flushIndex=0;for(var i=0,n=str.length;i<n;++i){var charCode=str.charCodeAt(i);if(numCharsWithoutBreak>=maxCharsBetweenWordBreaks&&charCode!=32){resultArr[resultArrLen++]=str.substring(flushIndex,i);flushIndex=i;resultArr[resultArrLen++]=goog.format.WORD_BREAK;numCharsWithoutBreak=0}if(isInTag){if(charCode==62){isInTag=false}}else{if(isMaybeInEntity){switch(charCode){case 59:isMaybeInEntity=false;++numCharsWithoutBreak;break;case 60:isMaybeInEntity=false;isInTag=true;break;case 32:isMaybeInEntity=false;numCharsWithoutBreak=0;break}}else{switch(charCode){case 60:isInTag=true;break;case 38:isMaybeInEntity=true;break;case 32:numCharsWithoutBreak=0;break;default:++numCharsWithoutBreak;break}}}}resultArr[resultArrLen++]=str.substring(flushIndex);return resultArr.join("")},WORD_BREAK:goog.userAgent.WEBKIT?"<wbr></wbr>":goog.userAgent.OPERA?"&shy;":"<wbr>"}}if(!goog.i18n){goog.i18n={bidi:{detectRtlDirectionality:function(text,opt_isHtml){text=soyshim.$$bidiStripHtmlIfNecessary_(text,opt_isHtml);return soyshim.$$bidiRtlWordRatio_(text)>soyshim.$$bidiRtlDetectionThreshold_}}}}goog.i18n.bidi.Dir={RTL:-1,UNKNOWN:0,LTR:1};goog.i18n.bidi.toDir=function(givenDir){if(typeof givenDir=="number"){return givenDir>0?goog.i18n.bidi.Dir.LTR:givenDir<0?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.UNKNOWN}else{return givenDir?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR}};goog.i18n.BidiFormatter=function(dir){this.dir_=goog.i18n.bidi.toDir(dir)};goog.i18n.BidiFormatter.prototype.dirAttr=function(text,opt_isHtml){var dir=soy.$$bidiTextDir(text,opt_isHtml);return dir&&dir!=this.dir_?dir<0?'dir="rtl"':'dir="ltr"':""};goog.i18n.BidiFormatter.prototype.endEdge=function(){return this.dir_<0?"left":"right"};goog.i18n.BidiFormatter.prototype.mark=function(){return((this.dir_>0)?"\u200E":(this.dir_<0)?"\u200F":"")};goog.i18n.BidiFormatter.prototype.markAfter=function(text,opt_isHtml){var dir=soy.$$bidiTextDir(text,opt_isHtml);return soyshim.$$bidiMarkAfterKnownDir_(this.dir_,dir,text,opt_isHtml)};goog.i18n.BidiFormatter.prototype.spanWrap=function(str,placeholder){str=String(str);var textDir=soy.$$bidiTextDir(str,true);var reset=soyshim.$$bidiMarkAfterKnownDir_(this.dir_,textDir,str,true);if(textDir>0&&this.dir_<=0){str='<span dir="ltr">'+str+"</span>"}else{if(textDir<0&&this.dir_>=0){str='<span dir="rtl">'+str+"</span>"}}return str+reset};goog.i18n.BidiFormatter.prototype.startEdge=function(){return this.dir_<0?"right":"left"};goog.i18n.BidiFormatter.prototype.unicodeWrap=function(str,placeholder){str=String(str);var textDir=soy.$$bidiTextDir(str,true);var reset=soyshim.$$bidiMarkAfterKnownDir_(this.dir_,textDir,str,true);if(textDir>0&&this.dir_<=0){str="\u202A"+str+"\u202C"}else{if(textDir<0&&this.dir_>=0){str="\u202B"+str+"\u202C"}}return str+reset};goog.string={newLineToBr:function(str,opt_xml){str=String(str);if(!goog.string.NEWLINE_TO_BR_RE_.test(str)){return str}return str.replace(/(\r\n|\r|\n)/g,opt_xml?"<br />":"<br>")},urlEncode:encodeURIComponent,NEWLINE_TO_BR_RE_:/[\r\n]/};goog.string.StringBuffer=function(opt_a1,var_args){this.buffer_=goog.userAgent.jscript.HAS_JSCRIPT?[]:"";if(opt_a1!=null){this.append.apply(this,arguments)}};goog.string.StringBuffer.prototype.bufferLength_=0;goog.string.StringBuffer.prototype.append=function(a1,opt_a2,var_args){if(goog.userAgent.jscript.HAS_JSCRIPT){if(opt_a2==null){this.buffer_[this.bufferLength_++]=a1}else{var arr=(this.buffer_);arr.push.apply(arr,arguments);this.bufferLength_=this.buffer_.length}}else{this.buffer_+=a1;if(opt_a2!=null){for(var i=1;i<arguments.length;i++){this.buffer_+=arguments[i]}}}return this};goog.string.StringBuffer.prototype.clear=function(){if(goog.userAgent.jscript.HAS_JSCRIPT){this.buffer_.length=0;this.bufferLength_=0}else{this.buffer_=""}};goog.string.StringBuffer.prototype.toString=function(){if(goog.userAgent.jscript.HAS_JSCRIPT){var str=this.buffer_.join("");this.clear();if(str){this.append(str)}return str}else{return(this.buffer_)}};if(!goog.soy){goog.soy={renderAsElement:function(template,opt_templateData,opt_injectedData,opt_dom){return(soyshim.$$renderWithWrapper_(template,opt_templateData,opt_dom,true,opt_injectedData))},renderAsFragment:function(template,opt_templateData,opt_injectedData,opt_dom){return soyshim.$$renderWithWrapper_(template,opt_templateData,opt_dom,false,opt_injectedData)},renderElement:function(element,template,opt_templateData,opt_injectedData){element.innerHTML=template(opt_templateData,null,opt_injectedData)},data:{}}}goog.soy.data.SanitizedContentKind={HTML:{},JS:goog.DEBUG?{sanitizedContentJsStrChars:true}:{},JS_STR_CHARS:{},URI:{},ATTRIBUTES:goog.DEBUG?{sanitizedContentHtmlAttribute:true}:{},CSS:{},TEXT:{}};goog.soy.data.SanitizedContent=function(){throw Error("Do not instantiate directly")};goog.soy.data.SanitizedContent.prototype.contentKind;goog.soy.data.SanitizedContent.prototype.content;goog.soy.data.SanitizedContent.prototype.toString=function(){return this.content};var soy={esc:{}};var soydata={};soydata.VERY_UNSAFE={};var soyshim={$$DEFAULT_TEMPLATE_DATA_:{}};soyshim.$$renderWithWrapper_=function(template,opt_templateData,opt_dom,opt_asElement,opt_injectedData){var dom=opt_dom||document;var wrapper=dom.createElement("div");wrapper.innerHTML=template(opt_templateData||soyshim.$$DEFAULT_TEMPLATE_DATA_,undefined,opt_injectedData);if(wrapper.childNodes.length==1){var firstChild=wrapper.firstChild;if(!opt_asElement||firstChild.nodeType==1){return(firstChild)}}if(opt_asElement){return wrapper}var fragment=dom.createDocumentFragment();while(wrapper.firstChild){fragment.appendChild(wrapper.firstChild)}return fragment};soyshim.$$bidiMarkAfterKnownDir_=function(bidiGlobalDir,dir,text,opt_isHtml){return(bidiGlobalDir>0&&(dir<0||soyshim.$$bidiIsRtlExitText_(text,opt_isHtml))?"\u200E":bidiGlobalDir<0&&(dir>0||soyshim.$$bidiIsLtrExitText_(text,opt_isHtml))?"\u200F":"")};soyshim.$$bidiStripHtmlIfNecessary_=function(str,opt_isHtml){return opt_isHtml?str.replace(soyshim.$$BIDI_HTML_SKIP_RE_," "):str};soyshim.$$BIDI_HTML_SKIP_RE_=/<[^>]*>|&[^;]+;/g;soyshim.$$bidiLtrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u2C00-\uFB1C\uFDFE-\uFE6F\uFEFD-\uFFFF";soyshim.$$bidiNeutralChars_="\u0000-\u0020!-@[-`{-\u00BF\u00D7\u00F7\u02B9-\u02FF\u2000-\u2BFF";soyshim.$$bidiRtlChars_="\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC";soyshim.$$bidiRtlDirCheckRe_=new RegExp("^[^"+soyshim.$$bidiLtrChars_+"]*["+soyshim.$$bidiRtlChars_+"]");soyshim.$$bidiNeutralDirCheckRe_=new RegExp("^["+soyshim.$$bidiNeutralChars_+"]*$|^http://");soyshim.$$bidiIsRtlText_=function(str){return soyshim.$$bidiRtlDirCheckRe_.test(str)};soyshim.$$bidiIsNeutralText_=function(str){return soyshim.$$bidiNeutralDirCheckRe_.test(str)};soyshim.$$bidiRtlDetectionThreshold_=0.4;soyshim.$$bidiRtlWordRatio_=function(str){var rtlCount=0;var totalCount=0;var tokens=str.split(" ");for(var i=0;i<tokens.length;i++){if(soyshim.$$bidiIsRtlText_(tokens[i])){rtlCount++;totalCount++}else{if(!soyshim.$$bidiIsNeutralText_(tokens[i])){totalCount++}}}return totalCount==0?0:rtlCount/totalCount};soyshim.$$bidiLtrExitDirCheckRe_=new RegExp("["+soyshim.$$bidiLtrChars_+"][^"+soyshim.$$bidiRtlChars_+"]*$");soyshim.$$bidiRtlExitDirCheckRe_=new RegExp("["+soyshim.$$bidiRtlChars_+"][^"+soyshim.$$bidiLtrChars_+"]*$");soyshim.$$bidiIsLtrExitText_=function(str,opt_isHtml){str=soyshim.$$bidiStripHtmlIfNecessary_(str,opt_isHtml);return soyshim.$$bidiLtrExitDirCheckRe_.test(str)};soyshim.$$bidiIsRtlExitText_=function(str,opt_isHtml){str=soyshim.$$bidiStripHtmlIfNecessary_(str,opt_isHtml);return soyshim.$$bidiRtlExitDirCheckRe_.test(str)};soy.StringBuilder=goog.string.StringBuffer;soydata.SanitizedContentKind=goog.soy.data.SanitizedContentKind;soydata.SanitizedHtml=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedHtml,goog.soy.data.SanitizedContent);soydata.SanitizedHtml.prototype.contentKind=soydata.SanitizedContentKind.HTML;soydata.SanitizedJs=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedJs,goog.soy.data.SanitizedContent);soydata.SanitizedJs.prototype.contentKind=soydata.SanitizedContentKind.JS;soydata.SanitizedJsStrChars=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedJsStrChars,goog.soy.data.SanitizedContent);soydata.SanitizedJsStrChars.prototype.contentKind=soydata.SanitizedContentKind.JS_STR_CHARS;soydata.SanitizedUri=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedUri,goog.soy.data.SanitizedContent);soydata.SanitizedUri.prototype.contentKind=soydata.SanitizedContentKind.URI;soydata.SanitizedHtmlAttribute=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedHtmlAttribute,goog.soy.data.SanitizedContent);soydata.SanitizedHtmlAttribute.prototype.contentKind=soydata.SanitizedContentKind.ATTRIBUTES;soydata.SanitizedCss=function(){goog.soy.data.SanitizedContent.call(this)};goog.inherits(soydata.SanitizedCss,goog.soy.data.SanitizedContent);soydata.SanitizedCss.prototype.contentKind=soydata.SanitizedContentKind.CSS;soydata.UnsanitizedText=function(content){this.content=String(content)};goog.inherits(soydata.UnsanitizedText,goog.soy.data.SanitizedContent);soydata.UnsanitizedText.prototype.contentKind=soydata.SanitizedContentKind.TEXT;soydata.$$makeSanitizedContentFactory_=function(ctor){function InstantiableCtor(){}InstantiableCtor.prototype=ctor.prototype;return function(content){var result=new InstantiableCtor();result.content=String(content);return result}};soydata.markUnsanitizedText=function(content){return new soydata.UnsanitizedText(content)};soydata.VERY_UNSAFE.ordainSanitizedHtml=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedHtml);soydata.VERY_UNSAFE.ordainSanitizedJs=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedJs);soydata.VERY_UNSAFE.ordainSanitizedJsStrChars=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedJsStrChars);soydata.VERY_UNSAFE.ordainSanitizedUri=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedUri);soydata.VERY_UNSAFE.ordainSanitizedHtmlAttribute=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedHtmlAttribute);soydata.VERY_UNSAFE.ordainSanitizedCss=soydata.$$makeSanitizedContentFactory_(soydata.SanitizedCss);soy.renderElement=goog.soy.renderElement;soy.renderAsFragment=function(template,opt_templateData,opt_document,opt_injectedData){return goog.soy.renderAsFragment(template,opt_templateData,opt_injectedData,new goog.dom.DomHelper(opt_document))};soy.renderAsElement=function(template,opt_templateData,opt_document,opt_injectedData){return goog.soy.renderAsElement(template,opt_templateData,opt_injectedData,new goog.dom.DomHelper(opt_document))};soy.$$augmentMap=function(baseMap,additionalMap){function TempCtor(){}TempCtor.prototype=baseMap;var augmentedMap=new TempCtor();for(var key in additionalMap){augmentedMap[key]=additionalMap[key]}return augmentedMap};soy.$$checkMapKey=function(key){if((typeof key)!="string"){throw Error("Map literal's key expression must evaluate to string (encountered type \""+(typeof key)+'").')}return key};soy.$$getMapKeys=function(map){var mapKeys=[];for(var key in map){mapKeys.push(key)}return mapKeys};soy.$$getDelTemplateId=function(delTemplateName){return delTemplateName};soy.$$DELEGATE_REGISTRY_PRIORITIES_={};soy.$$DELEGATE_REGISTRY_FUNCTIONS_={};soy.$$registerDelegateFn=function(delTemplateId,delTemplateVariant,delPriority,delFn){var mapKey="key_"+delTemplateId+":"+delTemplateVariant;var currPriority=soy.$$DELEGATE_REGISTRY_PRIORITIES_[mapKey];if(currPriority===undefined||delPriority>currPriority){soy.$$DELEGATE_REGISTRY_PRIORITIES_[mapKey]=delPriority;soy.$$DELEGATE_REGISTRY_FUNCTIONS_[mapKey]=delFn}else{if(delPriority==currPriority){throw Error('Encountered two active delegates with the same priority ("'+delTemplateId+":"+delTemplateVariant+'").')}else{}}};soy.$$getDelegateFn=function(delTemplateId,delTemplateVariant,allowsEmptyDefault){var delFn=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+delTemplateId+":"+delTemplateVariant];if(!delFn&&delTemplateVariant!=""){delFn=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+delTemplateId+":"]}if(delFn){return delFn}else{if(allowsEmptyDefault){return soy.$$EMPTY_TEMPLATE_FN_}else{throw Error('Found no active impl for delegate call to "'+delTemplateId+":"+delTemplateVariant+'" (and not allowemptydefault="true").')}}};soy.$$EMPTY_TEMPLATE_FN_=function(opt_data,opt_sb,opt_ijData){return""};soy.$$escapeHtml=function(value){if(value&&value.contentKind&&value.contentKind===goog.soy.data.SanitizedContentKind.HTML){goog.asserts.assert(value.constructor===soydata.SanitizedHtml);return value.content}return soy.esc.$$escapeHtmlHelper(value)};soy.$$cleanHtml=function(value){if(value&&value.contentKind&&value.contentKind===goog.soy.data.SanitizedContentKind.HTML){goog.asserts.assert(value.constructor===soydata.SanitizedHtml);return value.content}return soy.$$stripHtmlTags(value,soy.esc.$$SAFE_TAG_WHITELIST_)};soy.$$escapeHtmlRcdata=function(value){if(value&&value.contentKind&&value.contentKind===goog.soy.data.SanitizedContentKind.HTML){goog.asserts.assert(value.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlHelper(value.content)}return soy.esc.$$escapeHtmlHelper(value)};soy.$$HTML5_VOID_ELEMENTS_=new RegExp("^<(?:area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)\\b");soy.$$stripHtmlTags=function(value,opt_tagWhitelist){if(!opt_tagWhitelist){return String(value).replace(soy.esc.$$HTML_TAG_REGEX_,"").replace(soy.esc.$$LT_REGEX_,"&lt;")}var html=String(value).replace(/\[/g,"&#91;");var tags=[];html=html.replace(soy.esc.$$HTML_TAG_REGEX_,function(tok,tagName){if(tagName){tagName=tagName.toLowerCase();if(opt_tagWhitelist.hasOwnProperty(tagName)&&opt_tagWhitelist[tagName]){var start=tok.charAt(1)==="/"?"</":"<";var index=tags.length;tags[index]=start+tagName+">";return"["+index+"]"}}return""});html=soy.esc.$$normalizeHtmlHelper(html);var finalCloseTags=soy.$$balanceTags_(tags);html=html.replace(/\[(\d+)\]/g,function(_,index){return tags[index]});return html+finalCloseTags};soy.$$balanceTags_=function(tags){var open=[];for(var i=0,n=tags.length;i<n;++i){var tag=tags[i];if(tag.charAt(1)==="/"){var openTagIndex=open.length-1;while(openTagIndex>=0&&open[openTagIndex]!=tag){openTagIndex--}if(openTagIndex<0){tags[i]=""}else{tags[i]=open.slice(openTagIndex).reverse().join("");open.length=openTagIndex}}else{if(!soy.$$HTML5_VOID_ELEMENTS_.test(tag)){open.push("</"+tag.substring(1))}}}return open.reverse().join("")};soy.$$escapeHtmlAttribute=function(value){if(value&&value.contentKind){if(value.contentKind===goog.soy.data.SanitizedContentKind.HTML){goog.asserts.assert(value.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlHelper(soy.$$stripHtmlTags(value.content))}}return soy.esc.$$escapeHtmlHelper(value)};soy.$$escapeHtmlAttributeNospace=function(value){if(value&&value.contentKind){if(value.contentKind===goog.soy.data.SanitizedContentKind.HTML){goog.asserts.assert(value.constructor===soydata.SanitizedHtml);return soy.esc.$$normalizeHtmlNospaceHelper(soy.$$stripHtmlTags(value.content))}}return soy.esc.$$escapeHtmlNospaceHelper(value)};soy.$$filterHtmlAttributes=function(value){if(value&&value.contentKind===goog.soy.data.SanitizedContentKind.ATTRIBUTES){goog.asserts.assert(value.constructor===soydata.SanitizedHtmlAttribute);return value.content.replace(/([^"'\s])$/,"$1 ")}return soy.esc.$$filterHtmlAttributesHelper(value)};soy.$$filterHtmlElementName=function(value){return soy.esc.$$filterHtmlElementNameHelper(value)};soy.$$escapeJs=function(value){return soy.$$escapeJsString(value)};soy.$$escapeJsString=function(value){if(value&&value.contentKind===goog.soy.data.SanitizedContentKind.JS_STR_CHARS){goog.asserts.assert(value.constructor===soydata.SanitizedJsStrChars);return value.content}return soy.esc.$$escapeJsStringHelper(value)};soy.$$escapeJsValue=function(value){if(value==null){return" null "}if(value.contentKind==goog.soy.data.SanitizedContentKind.JS){goog.asserts.assert(value.constructor===soydata.SanitizedJs);return value.content}switch(typeof value){case"boolean":case"number":return" "+value+" ";default:return"'"+soy.esc.$$escapeJsStringHelper(String(value))+"'"}};soy.$$escapeJsRegex=function(value){return soy.esc.$$escapeJsRegexHelper(value)};soy.$$problematicUriMarks_=/['()]/g;soy.$$pctEncode_=function(ch){return"%"+ch.charCodeAt(0).toString(16)};soy.$$escapeUri=function(value){if(value&&value.contentKind===goog.soy.data.SanitizedContentKind.URI){goog.asserts.assert(value.constructor===soydata.SanitizedUri);return soy.$$normalizeUri(value)}var encoded=soy.esc.$$escapeUriHelper(value);soy.$$problematicUriMarks_.lastIndex=0;if(soy.$$problematicUriMarks_.test(encoded)){return encoded.replace(soy.$$problematicUriMarks_,soy.$$pctEncode_)}return encoded};soy.$$normalizeUri=function(value){return soy.esc.$$normalizeUriHelper(value)};soy.$$filterNormalizeUri=function(value){if(value&&value.contentKind==goog.soy.data.SanitizedContentKind.URI){goog.asserts.assert(value.constructor===soydata.SanitizedUri);return soy.$$normalizeUri(value)}return soy.esc.$$filterNormalizeUriHelper(value)};soy.$$escapeCssString=function(value){return soy.esc.$$escapeCssStringHelper(value)};soy.$$filterCssValue=function(value){if(value&&value.contentKind===goog.soy.data.SanitizedContentKind.CSS){goog.asserts.assert(value.constructor===soydata.SanitizedCss);return value.content}if(value==null){return""}return soy.esc.$$filterCssValueHelper(value)};soy.$$filterNoAutoescape=function(value){if(value&&value.contentKind===goog.soy.data.SanitizedContentKind.TEXT){goog.asserts.fail("Tainted SanitizedContentKind.TEXT for |noAutoescape: `%s`",[value.content]);return"zSoyz"}return String(value)};soy.$$changeNewlineToBr=function(str){return goog.string.newLineToBr(String(str),false)};soy.$$insertWordBreaks=function(str,maxCharsBetweenWordBreaks){return goog.format.insertWordBreaks(String(str),maxCharsBetweenWordBreaks)};soy.$$truncate=function(str,maxLen,doAddEllipsis){str=String(str);if(str.length<=maxLen){return str}if(doAddEllipsis){if(maxLen>3){maxLen-=3}else{doAddEllipsis=false}}if(soy.$$isHighSurrogate_(str.charAt(maxLen-1))&&soy.$$isLowSurrogate_(str.charAt(maxLen))){maxLen-=1}str=str.substring(0,maxLen);if(doAddEllipsis){str+="..."}return str};soy.$$isHighSurrogate_=function(ch){return 55296<=ch&&ch<=56319};soy.$$isLowSurrogate_=function(ch){return 56320<=ch&&ch<=57343};soy.$$bidiFormatterCache_={};soy.$$getBidiFormatterInstance_=function(bidiGlobalDir){return soy.$$bidiFormatterCache_[bidiGlobalDir]||(soy.$$bidiFormatterCache_[bidiGlobalDir]=new goog.i18n.BidiFormatter(bidiGlobalDir))};soy.$$bidiTextDir=function(text,opt_isHtml){if(!text){return 0}return goog.i18n.bidi.detectRtlDirectionality(text,opt_isHtml)?-1:1};soy.$$bidiDirAttr=function(bidiGlobalDir,text,opt_isHtml){return soydata.VERY_UNSAFE.ordainSanitizedHtmlAttribute(soy.$$getBidiFormatterInstance_(bidiGlobalDir).dirAttr(text,opt_isHtml))};soy.$$bidiMarkAfter=function(bidiGlobalDir,text,opt_isHtml){var formatter=soy.$$getBidiFormatterInstance_(bidiGlobalDir);return formatter.markAfter(text,opt_isHtml)};soy.$$bidiSpanWrap=function(bidiGlobalDir,str){var formatter=soy.$$getBidiFormatterInstance_(bidiGlobalDir);return formatter.spanWrap(str+"",true)};soy.$$bidiUnicodeWrap=function(bidiGlobalDir,str){var formatter=soy.$$getBidiFormatterInstance_(bidiGlobalDir);return formatter.unicodeWrap(str+"",true)};soy.esc.$$escapeUriHelper=function(v){return goog.string.urlEncode(String(v))};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_={"\x00":"\x26#0;","\x22":"\x26quot;","\x26":"\x26amp;","\x27":"\x26#39;","\x3c":"\x26lt;","\x3e":"\x26gt;","\x09":"\x26#9;","\x0a":"\x26#10;","\x0b":"\x26#11;","\x0c":"\x26#12;","\x0d":"\x26#13;"," ":"\x26#32;","-":"\x26#45;","/":"\x26#47;","\x3d":"\x26#61;","`":"\x26#96;","\x85":"\x26#133;","\xa0":"\x26#160;","\u2028":"\x26#8232;","\u2029":"\x26#8233;"};soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_=function(ch){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_[ch]};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_={"\x00":"\\x00","\x08":"\\x08","\x09":"\\t","\x0a":"\\n","\x0b":"\\x0b","\x0c":"\\f","\x0d":"\\r","\x22":"\\x22","\x26":"\\x26","\x27":"\\x27","/":"\\/","\x3c":"\\x3c","\x3d":"\\x3d","\x3e":"\\x3e","\\":"\\\\","\x85":"\\x85","\u2028":"\\u2028","\u2029":"\\u2029","$":"\\x24","(":"\\x28",")":"\\x29","*":"\\x2a","+":"\\x2b",",":"\\x2c","-":"\\x2d",".":"\\x2e",":":"\\x3a","?":"\\x3f","[":"\\x5b","]":"\\x5d","^":"\\x5e","{":"\\x7b","|":"\\x7c","}":"\\x7d"};soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_=function(ch){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_[ch]};soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_={"\x00":"\\0 ","\x08":"\\8 ","\x09":"\\9 ","\x0a":"\\a ","\x0b":"\\b ","\x0c":"\\c ","\x0d":"\\d ","\x22":"\\22 ","\x26":"\\26 ","\x27":"\\27 ","(":"\\28 ",")":"\\29 ","*":"\\2a ","/":"\\2f ",":":"\\3a ",";":"\\3b ","\x3c":"\\3c ","\x3d":"\\3d ","\x3e":"\\3e ","@":"\\40 ","\\":"\\5c ","{":"\\7b ","}":"\\7d ","\x85":"\\85 ","\xa0":"\\a0 ","\u2028":"\\2028 ","\u2029":"\\2029 "};soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_=function(ch){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_[ch]};soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_={"\x00":"%00","\x01":"%01","\x02":"%02","\x03":"%03","\x04":"%04","\x05":"%05","\x06":"%06","\x07":"%07","\x08":"%08","\x09":"%09","\x0a":"%0A","\x0b":"%0B","\x0c":"%0C","\x0d":"%0D","\x0e":"%0E","\x0f":"%0F","\x10":"%10","\x11":"%11","\x12":"%12","\x13":"%13","\x14":"%14","\x15":"%15","\x16":"%16","\x17":"%17","\x18":"%18","\x19":"%19","\x1a":"%1A","\x1b":"%1B","\x1c":"%1C","\x1d":"%1D","\x1e":"%1E","\x1f":"%1F"," ":"%20","\x22":"%22","\x27":"%27","(":"%28",")":"%29","\x3c":"%3C","\x3e":"%3E","\\":"%5C","{":"%7B","}":"%7D","\x7f":"%7F","\x85":"%C2%85","\xa0":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","\uff01":"%EF%BC%81","\uff03":"%EF%BC%83","\uff04":"%EF%BC%84","\uff06":"%EF%BC%86","\uff07":"%EF%BC%87","\uff08":"%EF%BC%88","\uff09":"%EF%BC%89","\uff0a":"%EF%BC%8A","\uff0b":"%EF%BC%8B","\uff0c":"%EF%BC%8C","\uff0f":"%EF%BC%8F","\uff1a":"%EF%BC%9A","\uff1b":"%EF%BC%9B","\uff1d":"%EF%BC%9D","\uff1f":"%EF%BC%9F","\uff20":"%EF%BC%A0","\uff3b":"%EF%BC%BB","\uff3d":"%EF%BC%BD"};soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=function(ch){return soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_[ch]};soy.esc.$$MATCHER_FOR_ESCAPE_HTML_=/[\x00\x22\x26\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_=/[\x00\x22\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x26\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_=/[\x00\x08-\x0d\x22\x26\x27\/\x3c-\x3e\\\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_=/[\x00\x08-\x0d\x22\x24\x26-\/\x3a\x3c-\x3f\x5b-\x5e\x7b-\x7d\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_=/[\x00\x08-\x0d\x22\x26-\x2a\/\x3a-\x3e@\\\x7b\x7d\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g;soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i;soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_=/^(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTES_=/^(?!style|on|action|archive|background|cite|classid|codebase|data|dsync|href|longdesc|src|usemap)(?:[a-z0-9_$:-]*)$/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_=/^(?!script|style|title|textarea|xmp|no)[a-z0-9_$:-]*$/i;soy.esc.$$escapeHtmlHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$normalizeHtmlHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeHtmlNospaceHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$normalizeHtmlNospaceHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeJsStringHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeJsRegexHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeCssStringHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_)};soy.esc.$$filterCssValueHelper=function(value){var str=String(value);if(!soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_.test(str)){goog.asserts.fail("Bad value `%s` for |filterCssValue",[str]);return"zSoyz"}return str};soy.esc.$$normalizeUriHelper=function(value){var str=String(value);return str.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};soy.esc.$$filterNormalizeUriHelper=function(value){var str=String(value);if(!soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_.test(str)){goog.asserts.fail("Bad value `%s` for |filterNormalizeUri",[str]);return"#zSoyz"}return str.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};soy.esc.$$filterHtmlAttributesHelper=function(value){var str=String(value);if(!soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTES_.test(str)){goog.asserts.fail("Bad value `%s` for |filterHtmlAttributes",[str]);return"zSoyz"}return str};soy.esc.$$filterHtmlElementNameHelper=function(value){var str=String(value);if(!soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_.test(str)){goog.asserts.fail("Bad value `%s` for |filterHtmlElementName",[str]);return"zSoyz"}return str};soy.esc.$$HTML_TAG_REGEX_=/<(?:!|\/?([a-zA-Z][a-zA-Z0-9:\-]*))(?:[^>'"]|"[^"]*"|'[^']*')*>/g;soy.esc.$$LT_REGEX_=/</g;soy.esc.$$SAFE_TAG_WHITELIST_={b:1,br:1,em:1,i:1,s:1,sub:1,sup:1,u:1};if(typeof jive=="undefined"){var jive={}}if(typeof jive.fbldr=="undefined"){jive.fbldr={}}if(typeof jive.fbldr.create=="undefined"){jive.fbldr.create={}}if(typeof jive.fbldr.create.soy=="undefined"){jive.fbldr.create.soy={}}jive.fbldr.create.soy.addField=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field"><label class="fbldr-label">Add Field</label><span class="fbldr-glyph fbldr-reqd">&nbsp;</span><button type="button" id="fbldr-field-add">Add Field</button></div><div id="fbldr-create-error-box" class="fbldr-error-box" style="display: none"><span class="jive-icon-med jive-icon-redalert"></span><span class="message"></span></div>');return opt_sb?"":output.toString()};jive.fbldr.create.soy.field=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<li><div class="fbldr-create-field"><input type="hidden" value="',soy.$$escapeHtml(opt_data.json),'"/><span class="fbldr-create-field-id">',soy.$$escapeHtml(opt_data.field.id),'</span><span class="fbldr-create-field-label" ',(opt_data.field.desc)?'title="'+soy.$$escapeHtml(opt_data.field.desc)+'"':"",">",soy.$$escapeHtml(opt_data.field.label),'</span><a class="fbldr-field-link fbldr-field-del" href="#" title="Remove Field"><span class="jive-icon-med jive-icon-delete"></span></a><a class="fbldr-field-link fbldr-field-down" href="#" title="Move Field Down"><span class="jive-icon-med jive-icon-arrow-down"></span></a><a class="fbldr-field-link fbldr-field-up" href="#" title="Move Field Up"><span class="jive-icon-med jive-icon-arrow-up"></span></a></div></li>');return opt_sb?"":output.toString()};jive.fbldr.create.soy.headingText=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-create-preview-text"><p>Use the panels on the right to enter the template and field information, which will automatically render the form preview below.</p><p>&nbsp;</p><p>Once the form has been successfully created, you may either fill out the form and preview the content in the Content Preview tab, or copy the generated form template from the Form Source tab and store in a Jive document to be used by the Forms App.</p></div>');return opt_sb?"":output.toString()};if(typeof jive=="undefined"){var jive={}}if(typeof jive.fbldr=="undefined"){jive.fbldr={}}if(typeof jive.fbldr.soy=="undefined"){jive.fbldr.soy={}}jive.fbldr.soy.attachments=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-attachments"><div class="fbldr-attach-head"><p>Use the following form to upload file attachments and, optionally, include a variable to reference the uploaded file in the form\'s HTML source.</p><p>Multiple files may be attached, but only one at a time.  Click "Finished" when all files have been attached.</p></div><div class="fbldr-attach-field"><label>Link to HTML Variable (optional) : </label></div><div class="fbldr-attach-field"><select id="fbldr-attach-link"><option value="" selected="selected">Select HTML variable...</option>');var optionList23=opt_data.variables;var optionListLen23=optionList23.length;for(var optionIndex23=0;optionIndex23<optionListLen23;optionIndex23++){var optionData23=optionList23[optionIndex23];output.append('<option value="',soy.$$escapeHtml(optionData23),'">',soy.$$escapeHtml(optionData23),"</option>")}output.append('</select></div><div class="fbldr-attach-field"><button type="button" id="fbldr-attach-file">Upload File to Attach</button></div><div class="fbldr-attach-field"><label>Attached Files : </label><br/><ul id="fbldr-attach-files"></ul></div></div>');return opt_sb?"":output.toString()};jive.fbldr.soy.attachFile=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append("<li>",soy.$$escapeHtml(opt_data.attachment.name)," ",(opt_data.linkTo)?'<span class="fbldr-attach-link-to">(linked to \''+soy.$$escapeHtml(opt_data.linkTo)+"')</span>":"","</li>");return opt_sb?"":output.toString()};jive.fbldr.soy.attachImage=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<img alt="',soy.$$escapeHtml(opt_data.filename),'" class="jive-image" src="/servlet/JiveServlet/download/',soy.$$escapeHtml(opt_data.docId),"-1-",soy.$$escapeHtml(opt_data.attachId),"/",soy.$$escapeHtml(opt_data.filename),'" />');return opt_sb?"":output.toString()};jive.fbldr.soy.attachLink=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<a href="/servlet/JiveServlet/download/',soy.$$escapeHtml(opt_data.docId),"-1-",soy.$$escapeHtml(opt_data.attachId),"/",soy.$$escapeHtml(opt_data.filename),'">',soy.$$escapeHtml(opt_data.filename),"</a>");return opt_sb?"":output.toString()};jive.fbldr.soy.checkbox=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);output.append('<input type="checkbox" id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-checkbox" ',(opt_data.field.value)?'checked="checked"':""," ",(opt_data.field.name)?'name="'+soy.$$escapeHtml(opt_data.field.name)+'"':""," /></div>");return opt_sb?"":output.toString()};jive.fbldr.soy.divider=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-divider">&nbsp;</div>');return opt_sb?"":output.toString()};jive.fbldr.soy.error=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<span id="fbldr-error-',soy.$$escapeHtml(opt_data.field.id),'" class="jive-icon-sml jive-icon-redalert fbldr-error" style="display: none;" title=""></span>');return opt_sb?"":output.toString()};jive.fbldr.soy.form=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<form id="',soy.$$escapeHtml(opt_data.id),'" class="fbldr-form"></form>');return opt_sb?"":output.toString()};jive.fbldr.soy.header=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-header"><!-- <h2 class="fbldr-name">',soy.$$escapeHtml(opt_data.name),"</h2> -->",(opt_data.desc)?'<span class="fbldr-desc">'+soy.$$escapeHtml(opt_data.desc)+"</span>":"","</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.heading=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-heading"><span class="fbldr-heading-index">',soy.$$escapeHtml(opt_data.index),'</span><span class="fbldr-heading-text">',soy.$$escapeHtml(opt_data.text),"</span></div>");return opt_sb?"":output.toString()};jive.fbldr.soy.label=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<label class="fbldr-label">',soy.$$escapeHtml(opt_data.field.label),'</label><span class="fbldr-glyph fbldr-reqd">',(opt_data.field.required)?"*":"&nbsp;","</span>");return opt_sb?"":output.toString()};jive.fbldr.soy.load=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div id="fbldr-load"><span class="fbldr-load-img"></span><span class="fbldr-load-msg">Loading templates...</span><div id="fbldr-load-progress"><div class="fbldr-progress-text"></div></div></div>');return opt_sb?"":output.toString()};jive.fbldr.soy.options=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<option value="" class="fbldr-none">Select an option...</option>');var optionList117=opt_data.values;var optionListLen117=optionList117.length;for(var optionIndex117=0;optionIndex117<optionListLen117;optionIndex117++){var optionData117=optionList117[optionIndex117];output.append('<option class="fbldr-opt ',(optionData117.cssClass)?soy.$$escapeHtml(optionData117.cssClass):"",'" value="',soy.$$escapeHtml(optionData117.value),'" ',(optionData117.value==opt_data.value)?' selected="selected"':"",">",soy.$$escapeHtml(optionData117.label),"</option>")}return opt_sb?"":output.toString()};jive.fbldr.soy.notes=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-notes"><div class="fbldr-note"><span class="fbldr-glyph fbldr-reqd">*</span> Indicates a required field.</div>',(opt_data.includeAttachment)?'<div class="fbldr-note"><span class="fbldr-glyph fbldr-glyph-tall">+</span>File attachments will be included during form content submission.</div>':"","</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.radio=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);jive.fbldr.soy.radioOptions(opt_data,output);jive.fbldr.soy.error(opt_data,output);jive.fbldr.soy.title(opt_data,output);output.append("</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.radioOptions=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<ul class="fbldr-field-list">');var valueList147=opt_data.field.values;var valueListLen147=valueList147.length;for(var valueIndex147=0;valueIndex147<valueListLen147;valueIndex147++){var valueData147=valueList147[valueIndex147];output.append('<li><input type="radio" id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-radio" ',(opt_data.field.name)?'name="'+soy.$$escapeHtml(opt_data.field.name)+'" value="'+soy.$$escapeHtml(valueData147.value)+'"':"",(opt_data.field.value==valueData147.value)?'checked="checked"':""," />",(valueData147.label)?" "+soy.$$escapeHtml(valueData147.label)+" ":" "+soy.$$escapeHtml(valueData147.value)+" ","</li>")}output.append("</ul>");return opt_sb?"":output.toString()};jive.fbldr.soy.select=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);output.append('<select id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-input" ',(opt_data.field.name)?'name="'+soy.$$escapeHtml(opt_data.field.name)+'"':"",">");jive.fbldr.soy.options({values:opt_data.field.values,value:opt_data.field.value},output);output.append("</select>");jive.fbldr.soy.error(opt_data,output);jive.fbldr.soy.title(opt_data,output);output.append("</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.start=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div id="fbldr-start"><span class="fbldr-desc">You do not appear to have any forms currently available for use.</span><br /><div class="fbldr-text">In order to begin using the Forms App, there must be forms available in your community and your app must be proprely configured to locate those forms.  See the following help topics in the<span class="jive-icon-med jive-icon-question"></span>Forms App Help (upper-right) for further information:</div><ul><li><span class="jive-icon-med jive-icon-question"></span>Help Setting Up the App - See the "Configuring the App" help topic.<li><span class="jive-icon-med jive-icon-question"></span>Help Creating Custom Forms - See the "Getting Started" or "Additional Resources" help topics.</li></ul></div>');return opt_sb?"":output.toString()};jive.fbldr.soy.submit=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div id="fbldr-submit" class="clearfix"><button type="button" id="fbldr-submit-btn">',(opt_data.label)?soy.$$escapeHtml(opt_data.label):"Submit Form",'</button><div id="fbldr-submit-status"></div></div>');return opt_sb?"":output.toString()};jive.fbldr.soy.submitStatus=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append((opt_data.iconSrc)?'<img class="'+soy.$$escapeHtml(opt_data.iconCss)+'" src="'+soy.$$escapeHtml(opt_data.iconSrc)+'" />':(opt_data.iconCss)?'<span class="jive-icon jive-icon-med '+soy.$$escapeHtml(opt_data.iconCss)+'"></span>':"",'<span class="fbldr-submit-text">',opt_data.statusHtml,"</span>");return opt_sb?"":output.toString()};jive.fbldr.soy.submitSuccess=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append((opt_data.content.href)?'<a href="'+soy.$$escapeHtml(opt_data.content.href)+'" target="_blank" title="View '+soy.$$escapeHtml(opt_data.content.contentType)+": "+soy.$$escapeHtml(opt_data.content.subject)+'">'+soy.$$escapeHtml(opt_data.text)+"</a>":'<span class="fbldr-submit-success">'+soy.$$escapeHtml(opt_data.text)+"</span>");return opt_sb?"":output.toString()};jive.fbldr.soy.text=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);output.append('<input type="text" id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-input" value="',(opt_data.field.value)?soy.$$escapeHtml(opt_data.field.value):"",'" ',(opt_data.field.name)?'name="'+soy.$$escapeHtml(opt_data.field.name)+'"':""," />");jive.fbldr.soy.error(opt_data,output);jive.fbldr.soy.title(opt_data,output);output.append("</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.textarea=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);output.append('<textarea id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-input" rows="4">',(opt_data.field.value)?soy.$$escapeHtml(opt_data.field.value):"","</textarea>");jive.fbldr.soy.error(opt_data,output);jive.fbldr.soy.title(opt_data,output);output.append("</div>");return opt_sb?"":output.toString()};jive.fbldr.soy.title=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append((opt_data.field.title)?'<span class="jive-icon-sml jive-icon-info fbldr-title" title="'+soy.$$escapeHtml(opt_data.field.title)+'"></span>':"");return opt_sb?"":output.toString()};jive.fbldr.soy.userlink=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<a __jive_macro_name="user" __default_attr="',soy.$$escapeHtml(opt_data.userId),'" class="jive_macro jive_macro_user" href="">',soy.$$escapeHtml(opt_data.name),"</a>");return opt_sb?"":output.toString()};jive.fbldr.soy.userpicker=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-field">');jive.fbldr.soy.label(opt_data,output);output.append('<a href="#" id="fbldr-link-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-userpicker-link fbldr-input">select users</a>');jive.fbldr.soy.error(opt_data,output);jive.fbldr.soy.title(opt_data,output);output.append('<ul id="fbldr-field-',soy.$$escapeHtml(opt_data.field.id),'" class="fbldr-userpicker-list"></ul></div>');return opt_sb?"":output.toString()};jive.fbldr.soy.validationErrors=function(opt_data,opt_sb){var output=opt_sb||new soy.StringBuilder();output.append('<div class="fbldr-valid-errors">');var errorList292=opt_data.errors;var errorListLen292=errorList292.length;for(var errorIndex292=0;errorIndex292<errorListLen292;errorIndex292++){var errorData292=errorList292[errorIndex292];output.append('<div class="fbldr-valid-error"><span class="jive-icon-sml jive-icon-redalert fbldr-error"></span>&nbsp;<span class="fbldr-valid-error-text">',soy.$$escapeHtml(errorData292),"</span></div>")}output.append("</div>");return opt_sb?"":output.toString()};jive=jive||{};jive.fbldr=jive.fbldr||{};$j=jQuery.noConflict();jive.fbldr.dataFilter=function(data,type){return type==="json"?$j.trim(data.replace(/^throw [^;]*;/,"")):data};jive.fbldr.isDebug=function(){if(gadgets){var prefs=new gadgets.Prefs();return prefs.getBool("fbldr_debug")}else{return true}};jive.fbldr.isEmbedded=function(){return($j("body#fbldr-body-embed").length>0)};jive.fbldr.errorMessage=function(msg){var $p=$j("<p/>").html(msg);$j('<div title="Error"/>').append($p).dialog({modal:true})};jive.fbldr.successMessage=function(msg){var $p=$j("<p/>").html(msg);$j('<div title="Success"/>').append($p).dialog({modal:true})};(function($){$.extend({getQueryString:function(name){function parseParams(){try{var params={},e,a=/\+/g,r=/([^&=]+)=?([^&]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=window.parent.location.search.substring(1);while(e=r.exec(q)){params[d(e[1])]=d(e[2])}return params}catch(e){return{}}}if(!this.queryStringParams){this.queryStringParams=parseParams()}return this.queryStringParams[name]},getViewParam:function(name){if(gadgets){var viewParams=gadgets.views.getParams();return viewParams[name]}else{return null}}})})(jQuery);jive.fbldr.ContentCreator=function(template,form){var prefs=new gadgets.Prefs();var create=function(callback){var title=parse(template.content.title);var body=parse(template.content.body);if(jive.fbldr.isEmbedded()){osapi.jive.core.container.editor().insert(body)}else{getContainer(function(container){if(container.error){callback({error:container.error})}else{createContent(container,{title:title,body:body},callback)}})}};var preview=function(){var title=parse(template.content.title);var body=parse(template.content.body);return{title:title,body:body}};var parse=function(text){var replaced=text;for(var i=0;i<template.fields.length;i++){var field=template.fields[i];var value=getFieldValue(field);var valueRegex=new RegExp("\\{\\$"+field.id+"\\}","g");var labelRegex=new RegExp("\\{\\$"+field.id+"\\.label\\}","g");replaced=replaced.replace(valueRegex,value);replaced=replaced.replace(labelRegex,field.label)}return replaced};var getFieldValue=function(field){var value;if(field.type=="userpicker"){value=getUserPickerValues(field)}else{if(field.type=="userselect"){value=getUserSelectValues(field)}else{value=getSafeValue(field)}}return value};var getUserPickerValues=function(field){var userLinks=new Array();var users=$j(form).find("#fbldr-field-"+field.id).find("li");for(var i=0;i<users.length;i++){var id=$j(users[i]).attr("userid");var name=$j(users[i]).attr("username");userLinks.push(jive.fbldr.soy.userlink({userId:id,name:name}))}return userLinks.join(", ")};var getUserSelectValues=function(field){var userLinks=new Array();var userIds=$j(form).find("#fbldr-field-"+field.id).val().split(",");for(var i=0;i<userIds.length;i++){var id=$j.trim(userIds[i]);userLinks.push(jive.fbldr.soy.userlink({userId:id,name:""}))}return userLinks.join(", ")};var getSafeValue=function(field){return sanitizeValue($j(form).find("#fbldr-field-"+field.id))};var sanitizeValue=function(element){var value=$j(element).val();value=$j.trim(value);value=$j("<div/>").text(value).html();value=value.replace(/\n/g,"<br/>");return value};var createContent=function(container,content,callback){if(jive.fbldr.isDebug()){console.log("Create content in container: ",container);console.log("Content title: ",content.title);console.log("Content body: ",content.body)}var containerType=container.containerType;var containerId=container.containerId;var contentType=template.content.type;var data={subject:content.title,html:content.body};if(contentType=="document"){contentType="document"}else{if(contentType=="discussion"||contentType=="question"){data.question=(contentType=="question");contentType="discussion"}else{var error="Unable to create content of unknown type: "+contentType;callback({error:error});return}}if(containerType=="group"){postToGroup(containerId,contentType,data,callback)}else{if(containerType=="space"){postToSpace(containerId,contentType,data,callback)}}};var postToGroup=function(groupId,contentType,data,callback){osapi.jive.core.groups.get({id:groupId}).execute(function(response){if(response.error){callback({error:response.error.message});return}var group=response.data;if(contentType=="discussion"){postDiscussion(group,data,callback)}else{if(contentType=="document"){postDocument(group,data,callback)}}})};var postToSpace=function(spaceId,contentType,data,callback){osapi.jive.core.spaces.get({id:spaceId}).execute(function(response){if(response.error){callback({error:response.error.message});return}var space=response.data;if(contentType=="discussion"){postDiscussion(space,data,callback)}else{if(contentType=="document"){postDocument(space,data,callback)}}})};var postDiscussion=function(container,data,callback){container.discussions.create(data).execute(function(response){if(response.error){callback({error:response.error.message})}else{var discussion=response.data;discussion.contentType=(data.question)?"question":"discussion";discussion.href="/threads/"+response.data.id;discussion.subject=data.subject;doActions(discussion,callback)}})};var postDocument=function(container,data,callback){container.documents.create(data).execute(function(response){if(response.error){callback({error:response.error.message})}else{var document=response.data;document.contentType="document";document.href="/docs/DOC-"+response.data.id;document.subject=data.subject;if(template.content.includeAttachment){addAttachments(template,document,callback)}else{doActions(document,callback)}}})};var addAttachments=function(template,content,callback){var dirty=false;$j("#fbldr-dialog").html(jive.fbldr.soy.attachments({variables:getHtmlVariables(content.content.text)})).dialog({buttons:{Finished:function(){$j(this).dialog("close")}},closeOnEscape:false,modal:true,title:"Add Attachments",close:function(){if(dirty){content.update().execute(function(response){doActions(content,callback)})}else{doActions(content,callback)}}});$j("#fbldr-attach-file").click(function(){content.requestAttachmentUpload(function(attachment){if(!attachment||!attachment.id||!attachment.name||!attachment.contentType){console.log("Unable to add valid attachment:",attachment);return}console.log("Added attachment:",attachment);if(!content.attachments){content.attachments=[]}content.attachments.push(attachment);var linkField=$j("#fbldr-attach-link");var linkTo=sanitizeValue(linkField);if(linkTo){var parsedText=parseAttachment(linkTo,content,attachment);content.content.text=parsedText;$j("#fbldr-attach-link").find('option[value="'+linkTo+'"]').remove()}$j(linkField).val("");$j("#fbldr-attach-files").append(jive.fbldr.soy.attachFile({attachment:attachment,linkTo:linkTo}));dirty=true},{dialogTitle:"Form Attachment",instructionMsg:"Select a file to attach to the content being created by the form."})})};var getHtmlVariables=function(text){var variables=[];var varRegex=new RegExp("\\{\\$(.*?)\\.(?:link|img)\\}","g");var match;while(match=varRegex.exec(text)){var variable=match[1];if(variables.indexOf(variable)<0){variables.push(variable)}}return variables.sort()};var parseAttachment=function(linkTo,content,attachment){var replaced=content.content.text;var config={filename:attachment.name,attachId:attachment.id,docId:content.id};var linkRegex=new RegExp("\\{\\$"+linkTo+"\\.link\\}","g");replaced=replaced.replace(linkRegex,jive.fbldr.soy.attachLink(config));if(attachment.contentType&&attachment.contentType.indexOf("image")==0){var imgRegex=new RegExp("\\{\\$"+linkTo+"\\.img\\}","g");replaced=replaced.replace(imgRegex,jive.fbldr.soy.attachImage(config))}return replaced};var doActions=function(content,callback){content.href=getBaseUrl()+content.href;callback({content:content,error:null})};var getBaseUrl=function(){if(gadgets&&gadgets.util){return gadgets.util.getUrlParameters().parent}var baseUrl=window.location.protocol+"//"+window.location.host+((window.location.port)?":"+window.location.port:"");return baseUrl};var getContainer=function(callback){var container={containerType:$j.getViewParam("locationType"),containerId:parseInt($j.getViewParam("locationId"))};if(isValidContainer(container)){console.log("Got place from URL: ",container);callback(container)}else{var contentType=(template.content.type=="document")?"document":"discussion";osapi.jive.core.places.requestPicker({success:function(response){if(!response.data){callback({error:"Invalid place selected, must be a space or group."});return}var place=response.data;console.log("Got place from chooser: ",place);var uri=place.resources.self.ref;if(uri.indexOf("/spaces/")>=0){container.containerType="space"}else{if(uri.indexOf("/groups/")>=0){container.containerType="group"}}container.containerId=place.id;if(isValidContainer(container)){callback(container)}else{callback({error:"Invalid place selected, must be a space or group."})}},error:function(response){callback({error:response.message})},contentType:contentType})}};var isValidContainer=function(container){if(!container){return false}var containerType=container.containerType;var containerId=container.containerId;if(!containerType||(containerType!="group"&&containerType!="space")){return false}if(isNaN(containerId)||containerId<=0){return false}return true};return{create:create,preview:preview}};jive.fbldr.FormBuilder=function(options){var containerId=options.containerId;var container="#"+containerId;var prefs=new gadgets.Prefs();var handleCategoryChange=function(){var cat=$j(this).val();var templates=getTemplates(cat);$j(this).toggleClass("fbldr-none",(!cat));formRenderer.clear();$j("#fbldr-field-ctrl-tmplts").html("").removeClass("fbldr-opt-error").addClass("fbldr-none").append(jive.fbldr.soy.options({values:templates.templateValues}))};var handleTemplateChange=function(){var cat=$j("#fbldr-field-ctrl-cats").val();var index=$j(this).val();if(cat&&index){var templates=templateProvider.getTemplates(cat);var template=templates[parseInt(index)];renderTemplate(template)}else{$j(this).removeClass("fbldr-opt-error").addClass("fbldr-none");formRenderer.clear()}};var renderTemplate=function(template){if(!template){return}var hasErrors=typeof(template.errors)!="undefined";$j("#fbldr-field-ctrl-tmplts").removeClass("fbldr-none").toggleClass("fbldr-opt-error",hasErrors);formRenderer.render(template)};var init=function(){var categories=getCategories();var templates=getTemplates(categories.categoryValue);if(categories.categoryValues.length==0){renderGettingStarted();return}$j(container).addClass("fbldr-main").html("").append(jive.fbldr.soy.heading({index:1,text:"Select a Template Form"})).append(jive.fbldr.soy.select({field:{id:"ctrl-cats",label:"Category",values:categories.categoryValues,value:categories.categoryValue}})).append(jive.fbldr.soy.select({field:{id:"ctrl-tmplts",label:"Template",values:templates.templateValues,value:templates.templateValue}})).append('<div id="fbldr-container"></div>');$j("#fbldr-field-ctrl-cats").toggleClass("fbldr-none",(!categories.categoryValue)).change(handleCategoryChange);$j("#fbldr-field-ctrl-tmplts").toggleClass("fbldr-none",(!templates.template)).change(handleTemplateChange);renderTemplate(templates.template)};var renderGettingStarted=function(){$j(container).addClass("fbldr-main").html("").append(jive.fbldr.soy.heading({index:1,text:"Getting Started with Forms"})).append(jive.fbldr.soy.start())};var getCategories=function(){var categories=templateProvider.getCategories();var categoryValue=getCategoryValue(categories);var categoryValues=[];for(var i=0;i<categories.length;i++){var category=categories[i];categoryValues.push({value:category,label:category});if(!categoryValue&&(prefs.getString("fbldr_category")==category)){categoryValue=category}}return{categoryValues:categoryValues,categoryValue:categoryValue}};var getCategoryValue=function(categories){var category=$j.getViewParam("category");for(var i=0;i<categories.length;i++){if(categories[i]==category){return category}}if(categories.length==1){return categories[0]}return null};var getTemplates=function(cat){if(!cat){return{templateValues:[],templateValue:null}}var templates=templateProvider.getTemplates(cat);var templateMeta=getTemplateValue(templates);var templateIndex=templateMeta.templateIndex;var templateValue=templateMeta.templateValue;var templateValues=[];for(var i=0;i<templates.length;i++){var template=templates[i];var name=template.name;var cssClass="";if(template.errors&&template.errors.length>0){name+=" (!)";cssClass="fbldr-opt-error"}templateValues.push({value:i,label:name,cssClass:cssClass});if(!templateValue&&(prefs.getString("fbldr_template")==name)){templateValue=template;templateIndex=i}}return{templateValues:templateValues,templateValue:templateIndex,template:templateValue}};var getTemplateValue=function(templates){var template=$j.getViewParam("template");for(var i=0;i<templates.length;i++){if(templates[i].name==template){return{templateValue:templates[i],templateIndex:i}}}if(templates.length==1){return{templateValue:templates[0],templateIndex:0}}return{templateValue:null,templateIndex:-1}};var templateProvider=new jive.fbldr.TemplateProvider(options,{onLoad:init});var formRenderer=new jive.fbldr.FormRenderer(options)};jive.fbldr.FormCreator=function(options){options.preview=function(content){renderContentPreview(content)};var rebuildDelay=750;var rebuildTimeout=null;var formRenderer=new jive.fbldr.FormRenderer(options);var prefs=new gadgets.Prefs();var addField=function(){var field={};$j("#fbldr-field-form input, #fbldr-field-form select").each(function(){var name=$j(this).attr("name");var value=null;if($j(this).attr("type")=="checkbox"){value=$j(this).is(":checked")}else{value=$j(this).val()}if(name=="id"){value=value.replace(/\s+/g,"")}else{if(name=="patterns"||name=="values"){var values=[];if(value){var parts=value.split(",");for(var i=0;i<parts.length;i++){values.push($j.trim(parts[i]))}}value=values}}if(!value||value.length==0){return}field[name]=value});var fieldError=false;$j('#fbldr-fields input[type="hidden"]').each(function(){var value=$j(this).val();var otherField=JSON.parse(value);if(field.id==otherField.id){$j("#fbldr-create-error-box").find("span.message").html("Error: '"+field.id+"' is aleady defined.");$j("#fbldr-create-error-box").show();fieldError=true}});if(fieldError){return false}$j("#fbldr-fields").append(jive.fbldr.create.soy.field({field:field,json:JSON.stringify(field)}));$j("#jive-create-error-box").hide();$j("#fbldr-field-form").get(0).reset();return true};var buildCreateForm=function(){$j("#fbldr-create-form").append(jive.fbldr.soy.text({field:{id:"fbldr-form-category",label:"Category",name:"category",required:true,value:"My Category",title:"The category of the template, under which the template will appear under when selecting from the list of available templates in the app."}})).append(jive.fbldr.soy.text({field:{id:"fbldr-form-name",label:"Name",name:"name",required:true,value:"My Template",title:"The name of the template, which again will appear when selecting the template from the list of available templates in the app."}})).append(jive.fbldr.soy.text({field:{id:"fbldr-form-desc",label:"Description",name:"desc",required:true,value:"My Template Description",title:"A more verbose description of the template, and its intended use / purpose.  This will display above the template form, once the template is selected in the app."}})).append(jive.fbldr.soy.select({field:{id:"fbldr-form-type",label:"Content Type",name:"content.type",required:true,value:"document",title:"What type of content to create (Document, Discussion, etc.) when using the template to post from the home / canvas app view.",values:[{value:"document",label:"Document"},{value:"discussion",label:"Discussion"},{value:"question",label:"Question"}]}})).append(jive.fbldr.soy.checkbox({field:{id:"fbldr-form-attach",label:"Attachments",name:"content.includeAttachment",title:"If checked, the user will be allowed to add file and image attachments to the piece of content, after the form has been successfully posted to Jive."}})).append(jive.fbldr.soy.divider()).append(jive.fbldr.soy.radio({field:{id:"fbldr-form-body-type",label:"HTML Source",name:"form.contentSource",value:"document",values:[{value:"document",label:"Another Jive Document"},{value:"template",label:"Within This Template"}]}})).append(jive.fbldr.soy.text({field:{id:"fbldr-form-doc-id",label:"HTML Doc ID",name:"content.docId",required:true,value:"0"}})).append(jive.fbldr.soy.text({field:{id:"fbldr-form-title",label:"HMTL Title",name:"content.title",required:true}})).append(jive.fbldr.soy.text({field:{id:"fbldr-form-body",label:"HTML Body",name:"content.body",required:true}}));renderContentSource()};var buildFieldForm=function(){$j("#fbldr-field-form").append(jive.fbldr.soy.text({field:{id:"fbldr-field-id",label:"ID",name:"id",required:true,title:'The unique identifier for the field.  All whitespace will be removed from the ID field, and only alphanumeric, "-", and "_" characters should be used.'}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-label",label:"Label",name:"label",required:true,title:"The user-friendly label for the field, which will show next to the field when rendered in the form."}})).append(jive.fbldr.soy.select({field:{id:"fbldr-field-type",label:"Type",name:"type",required:true,value:"text",title:"The data / UI entry type of the field, Text Field, Date, etc.",values:[{value:"text",label:"Text Field"},{value:"textarea",label:"Text Area"},{value:"boolean",label:"Checkbox"},{value:"date",label:"Date Field"},{value:"select",label:"Select Option"},{value:"userpicker",label:"User Picker"}]}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-values",label:"Values",name:"values",required:true,title:"Options to choose from the select list.  Enter as comma-delimited list (e.g. value1, value2, value3)"}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-value",label:"Default Value",name:"value",title:"For text fields, and select fields, provides the default value that will be placed in the form when it first loads (does not apply to all field types)"}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-title",label:"Tooltip",name:"title",title:'A more verbose, descriptive text describing the use or format of the field, which is displayed when the user hovers over the "i" info icon to the right of the form field.'}})).append(jive.fbldr.soy.checkbox({field:{id:"fbldr-field-required",label:"Required",name:"required",title:"If checked, the user will be required to provide a value for this form field, and will not be allowed to submit the form successfully until a value is provided."}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-patterns",label:"Patterns",name:"patterns",title:"A list of regular expressions which can be used to validate the value entered for the field.  Enter as comma-delimited list (e.g. pattern1, pattern2, pattern3)"}})).append(jive.fbldr.soy.text({field:{id:"fbldr-field-pattern-error",label:"Pattern Error",name:"patternError",title:"A more user-friendly, human readable error to display when a regular expression is provided for validation and the value does not match."}})).append(jive.fbldr.create.soy.addField()).append(jive.fbldr.soy.divider());renderFieldValues()};var buildEmptyTemplate=function(){return{category:"",name:"",desc:"",fields:[],content:{type:"",docId:"",title:"",body:"",includeAttachment:false}}};var handleFormInputs=function(){$j("#fbldr-create-form input").keyup(function(event){if(event.which!=9&&event.which!=13){clearTimeout(rebuildTimeout);rebuildTimeout=setTimeout(rebuildViews,rebuildDelay)}return true});$j('#fbldr-create-form input[type="checkbox"],#fbldr-create-form select').change(function(){rebuildViews();return true});$j('#fbldr-create-form input[type="radio"]').change(renderContentSource)};var handleFieldInputs=function(){$j('#fbldr-field-form select[name="type"]').change(renderFieldValues);$j("#fbldr-field-add").click(function(){if(addField()){rebuildViews()}});$j("#fbldr-fields").on("click","a.fbldr-field-del",function(){$j(this).closest("li").remove();rebuildViews();return false});$j("#fbldr-fields").on("click","a.fbldr-field-down",function(){var listItem=$j(this).closest("li");var index=listItem.index();var last=$j("#fbldr-fields").children("li").length-1;if(index!=last){listItem.next().after(listItem);rebuildViews()}return false});$j("#fbldr-fields").on("click","a.fbldr-field-up",function(){var listItem=$j(this).closest("li");var index=listItem.index();if(index!=0){listItem.prev().before(listItem);rebuildViews()}return false})};var rebuildViews=function(){var data=rebuildTemplate();rebuildPreview(data);rebuildSource(data)};var rebuildTemplate=function(){var template=buildEmptyTemplate();$j("#fbldr-create-form input,#fbldr-create-form select").each(function(){var names=$j(this).attr("name").split(".");if(names[0]=="form"){return}var value=null;if($j(this).attr("type")=="checkbox"){value=$j(this).is(":checked")}else{value=$j(this).val()}var obj=template;for(var i=0;i<names.length-1;i++){obj=obj[names[i]]}if($j(this).is(":disabled")){delete obj[names[names.length-1]]}else{obj[names[names.length-1]]=value}});$j('#fbldr-fields input[type="hidden"]').each(function(){var value=$j(this).val();var field=JSON.parse(value);template.fields.push(field)});return template};var rebuildPreview=function(data){new jive.fbldr.TemplateValidator(data,function(){formRenderer.render(data)})};var rebuildSource=function(data){var json=JSON.stringify(data,null,4);json=$j("<div />").text(json).html();var source="<pre>\n"+json+"\n</pre>\n";$j("#fbldr-create-text").val(source)};var renderContentPreview=function(content){$j("#fbldr-content-preview-head").html("Title : "+content.title);$j("#fbldr-content-preview-container").html(content.body);$j("#fbldr-create-views").tabs("option","disabled",[]);$j("#fbldr-create-views").tabs("option","selected",2)};var renderContentSource=function(){var value=$j('#fbldr-create-form input[type="radio"]:checked').val();var showDoc=(value=="document");$j("#fbldr-field-fbldr-form-doc-id").attr("disabled",showDoc?null:"disabled");$j("#fbldr-field-fbldr-form-title").attr("disabled",showDoc?"disabled":null);$j("#fbldr-field-fbldr-form-body").attr("disabled",showDoc?"disabled":null);$j("#fbldr-field-fbldr-form-doc-id").closest("div.fbldr-field").toggle(showDoc);$j("#fbldr-field-fbldr-form-title").closest("div.fbldr-field").toggle(!showDoc);$j("#fbldr-field-fbldr-form-body").closest("div.fbldr-field").toggle(!showDoc);rebuildViews()};var renderFieldValues=function(){var value=$j('#fbldr-field-form select[name="type"]').val();var showValues=(value=="select");$j("#fbldr-field-fbldr-field-values").attr("disabled",showValues?null:"disabled");$j("#fbldr-field-fbldr-field-values").closest("div.fbldr-field").toggle(showValues)};var renderPreviewHeader=function(){$j("#fbldr-create-preview-head").append(jive.fbldr.soy.heading({index:1,text:"Enter Template and Field Information"})).append(jive.fbldr.create.soy.headingText())};var init=function(){renderPreviewHeader();buildCreateForm();buildFieldForm();handleFormInputs();handleFieldInputs();rebuildViews();$j("#fbldr-menu-create").hide();$j("#fbldr-menu-help").show();$j("#fbldr-menu-forms").show();$j("#fbldr-create-views").tabs({disabled:[2]});$j("#fbldr-create-controls").tabs();$j("#fbldr-menu").fadeIn();$j("#fbldr-create").fadeIn()};init()};jive.fbldr.FormHelp=function(options){var prefs=new gadgets.Prefs();var init=function(){$j("#fbldr-menu-create").show();$j("#fbldr-menu-help").hide();$j("#fbldr-menu-forms").show();$j("#fbldr-help").tabs();$j("#fbldr-menu").fadeIn();$j("#fbldr-help").fadeIn()};init()};jive.fbldr.FormRenderer=function(options){var containerId="fbldr-container";var container="#"+containerId;var formId="fbldr-form";var form="#"+formId;var delay=500;var prefs=new gadgets.Prefs();var clear=function(callback,params){$j(container).fadeOut(delay,function(){$j("#fbldr-submit-status").toggleClass("fbldr-submit-error",false).html("").hide();$j(this).html("");if(!callback){callback=handleResize}callback(params)})};var render=function(template){if(!template){return}var callback=(template.errors)?showErrors:createForm;clear(callback,{template:template})};var showErrors=function(params){var template=params.template;$j(container).append(jive.fbldr.soy.heading({index:2,text:"Address Template Errors"})).append(jive.fbldr.soy.validationErrors({errors:template.errors})).fadeIn(delay,handleResize)};var createForm=function(params){var template=params.template;$j(container).append(jive.fbldr.soy.heading({index:2,text:"Fill Out Template Form"})).append(jive.fbldr.soy.header({name:template.name,desc:template.desc})).append(jive.fbldr.soy.form({id:formId}));for(var i=0;i<template.fields.length;i++){renderField(template.fields[i])}$j(form).append(jive.fbldr.soy.notes({includeAttachment:(template.content.type=="document"&&template.content.includeAttachment)})).append(jive.fbldr.soy.heading({index:3,text:"Submit Template Form"})).append(jive.fbldr.soy.submit({label:getSubmitLabel(template)}));handleSubmit(template);$j(container).fadeIn(delay,handleResize)};var getSubmitLabel=function(template){var contentType=template.content.type;var label="Submit Form";if(jive.fbldr.isEmbedded()){label="Insert Form Content"}else{if(contentType=="doc"||contentType=="document"){label="Create Document"}else{if(contentType=="discussion"||contentType=="thread"){label="Post Discussion"}else{if(contentType=="question"){label="Post Question"}}}}return label};var handleResize=function(){if(typeof(gadgets)!="undefined"){}};var handleSubmit=function(template){$j("#fbldr-submit-btn").click(function(){var form=$j(this).closest("form");var valid=new jive.fbldr.FormValidator(template,form).isValid();if(valid){if(options.preview){renderStatus("submit");var creator=new jive.fbldr.ContentCreator(template,form);var content=creator.preview();setTimeout(function(){renderStatus("success",null);options.preview(content)},delay)}else{renderStatus("submit");var creator=new jive.fbldr.ContentCreator(template,form);creator.create(handleCreated)}}else{renderStatus("error")}})};var handleCreated=function(response){if(response.error){var msg="Error creating content: "+response.error;jive.fbldr.errorMessage(msg);console.log(msg);renderStatus("failure")}else{var msg="Succesfully created "+response.content.contentType+": "+response.content.subject;renderStatus("success",response.content)}};var renderField=function(field){if(field.type=="boolean"){$j(form).append(jive.fbldr.soy.checkbox({field:field}))}else{if(field.type=="date"){$j(form).append(jive.fbldr.soy.text({field:field}));$j("#fbldr-field-"+field.id).datepicker({showOn:"both",buttonImage:$j("#fbldr-cal-icon").attr("src"),buttonImageOnly:true})}else{if(field.type=="select"||field.type=="userselect"){$j(form).append(jive.fbldr.soy.select({field:field}));$j("#fbldr-field-"+field.id).toggleClass("fbldr-none",!$j("#fbldr-field-"+field.id).val()).change(function(){$j(this).toggleClass("fbldr-none",!$j(this).val())})}else{if(field.type=="text"){$j(form).append(jive.fbldr.soy.text({field:field}))}else{if(field.type=="textarea"){$j(form).append(jive.fbldr.soy.textarea({field:field}))}else{if(field.type=="userpicker"){var options={field:field,multiple:true};$j(form).append(jive.fbldr.soy.userpicker(options));var userpicker=new jive.fbldr.UserPicker(options)}else{console.log("Unhandled field type: "+field.type+" ("+field.id+")")}}}}}}};var renderStatus=function(status,content){var isError=(status=="error"||status=="failure");$j("#fbldr-submit-status").toggleClass("fbldr-submit-error",isError);var statusOptions={statusHtml:"Status unknown",iconCss:"jive-icon-redalert"};if(status=="error"){statusOptions.statusHtml="Form contains errors."}else{if(status=="failure"){statusOptions.statusHtml="Error creating content."}else{if(status=="submit"){statusOptions.statusHtml="Creating content...";statusOptions.iconCss="fbldr-submit-load";statusOptions.iconSrc=$j("#fbldr-load-icon").attr("src")}else{if(status=="success"){statusOptions.iconCss="jive-icon-check";var text=(options.preview)?"Form preview success.":"New content created.";if(content){statusOptions.statusHtml=jive.fbldr.soy.submitSuccess({content:content,text:text});if(content.href&&isRedirect()){setTimeout(function(){window.parent.location=content.href},delay)}}else{statusOptions.statusHtml=text}}}}}$j("#fbldr-submit-status").html(jive.fbldr.soy.submitStatus(statusOptions)).show()};var isRedirect=function(){var urlRedirect=($j.getViewParam("redirect")=="true");var prefRedirect=prefs.getBool("fbldr_redirect");return(urlRedirect||prefRedirect)};return{clear:clear,render:render}};jive.fbldr.FormValidator=function(template,form){var isValid=function(){var hasError=false;for(var tIdx=0;tIdx<template.fields.length;tIdx++){var fieldError=false;var field=template.fields[tIdx];var value=getFieldValue(field);if(field.required&&!value){displayError(field,"'"+field.label+"' is a required field");fieldError=true}else{if(value&&value.length>0&&field.patterns&&field.patterns.length>0){var matches=false;for(var pIdx=0;pIdx<field.patterns.length;pIdx++){var pattern=field.patterns[pIdx];if(value.match(new RegExp(pattern))){matches=true;break}}if(!matches){var msg=getErrorMessage(field);displayError(field,msg);fieldError=true}}}if(fieldError){hasError=true}else{clearError(field)}}return !hasError};var getErrorMessage=function(field){var msg="'"+field.label+"' does not match ";if(field.patternError){msg+=field.patternError}else{if(field.patterns.length==1){msg+="the specified pattern '"+field.patterns[0]+"'"}else{msg+="any of the specified patterns"}}return msg};var clearError=function(field){getErrorElement(field).attr("title","").hide();getFieldElement(field).toggleClass("fbldr-input-error",false)};var displayError=function(field,msg){getErrorElement(field).attr("title",msg).show();getFieldElement(field).toggleClass("fbldr-input-error",true)};var getErrorElement=function(field){return $j(form).find("#fbldr-error-"+field.id)};var getFieldElement=function(field){return $j(form).find("#fbldr-field-"+field.id)};var getFieldValue=function(field){if(field.type=="userpicker"){var userIds=new Array();var users=getFieldElement(field).find("li");for(var i=0;i<users.length;i++){var id=$j(users[i]).attr("userid");if(id){userIds.push(id)}}return(userIds.length>0)?userIds:null}else{var value=getFieldElement(field).val();return(value)?$j.trim(value):""}};return{isValid:isValid}};jive.fbldr.TemplateProvider=function(options,handlers){var categories=[];var templateMap={};var getCategories=function(){return categories};var getTemplates=function(category){return templateMap[category]};var categorizeTemplates=function(templates){categories=[];templateMap={};for(var i=0;i<templates.length;i++){var template=templates[i];var category=templateMap[template.category];if(typeof(category)=="undefined"){templateMap[template.category]=[];category=templateMap[template.category];categories.push(template.category)}category.push(template)}categories.sort();for(var i=0;i<templateMap.length;i++){templateMap[i].sort(templateComparator)}if(handlers.onLoad){handlers.onLoad()}};var templateComparator=function(t1,t2){if(t1.name>t2.name){return 1}else{if(t1.name<t2.name){return -1}else{return 0}}};var init=function(){var sourceOptions=options;sourceOptions.onLoad=function(templates){categorizeTemplates(templates)};new jive.fbldr.JiveTemplateSource(sourceOptions).loadTemplates()};init();return{getCategories:getCategories,getTemplates:getTemplates}};jive.fbldr.JiveTemplateSource=function(options){var infoId=options.infoId;var info="#"+infoId;var loadId="fbldr-load";var load="#"+loadId;var menuId="fbldr-menu";var menu="#"+menuId;var progId="fbldr-load-progress";var prog="#"+progId;var onLoad=options.onLoad;var prefs=new gadgets.Prefs();var templates=[];var docsFound=0;var docsLoaded=0;var loadTemplates=function(){templates=[];docsFound=0;docsLoaded=0;showLoading();updateProgress(0);searchDocuments()};var searchDocuments=function(){var docs=prefs.getString("fbldr_docs").replace(/\s+/g,"").replace(/DOC-/gi,"").split(",");var tags=prefs.getString("fbldr_tags").replace(/\s*,\s*/g," OR ");var request=osapi.jive.core.searches.searchContent({query:tags,limit:100,type:["document"]});request.execute(function(response){var results=response.data||[];for(var i=0;i<results.length;i++){var doc=results[i];var docRef=doc.resources.self.ref;var docId=docRef.substring(docRef.lastIndexOf("/")+1);if($j.inArray(docId,docs)<0){docs.push(docId)}}getDocuments(docs)})};var checkComplete=function(forceComplete){if(!forceComplete&&(docsFound!=docsLoaded)){return}if(forceComplete){updateProgress(100)}setTimeout(complete,250)};var complete=function(){hideLoading();showMenu();if(onLoad){onLoad(templates)}else{console.log("Error: no onLoad callback specified for template source")}};var docLoaded=function(forceLoad){docsLoaded++;updateProgress(Math.round(docsLoaded/docsFound*100));checkComplete()};var getDocuments=function(docs){docsFound=docs.length;if(docsFound==0){checkComplete(true);return}for(var docIndex=0;docIndex<docs.length;docIndex++){var docId=docs[docIndex];var request=osapi.jive.core.documents.get({id:docId});request.execute(function(response){if(!response.data){docLoaded();return}var document=response.data;var text=$j("<div/>").html(document.content.text).html();text=text.replace(/\n/g,"").replace(/&nbsp;/g," ");var regex=/<pre.*?>(.*?)<\/pre>/gi;var match=regex.exec(text);if(match==null){docLoaded();return}var matches=[];while(match!=null){matches.push(match[1]);match=regex.exec(text)}parseTemplates(matches,document.subject)})}};var parseTemplates=function(unparsedTemplates,defaultCategory){var parsedTemplates=[];var handleParsedTemplate=function(template){parsedTemplates.push(template);if(parsedTemplates.length==unparsedTemplates.length){handledParsedTemplates(parsedTemplates)}};for(var i=0;i<unparsedTemplates.length;i++){parseTemplate(unparsedTemplates[i],defaultCategory,handleParsedTemplate)}};var parseTemplate=function(text,defaultCategory,callback){var template=null;try{text=$j("<div/>").html(text).text();template=$j.parseJSON(text);template.defaultCategory=defaultCategory;var validator=new jive.fbldr.TemplateValidator(template,function(){callback(template)})}catch(error){if(!template){template={}}var msg="Error validating template: "+error.message+"\n"+text;console.log(msg);template.errors=[msg];callback(template)}};var handledParsedTemplates=function(parsedTemplates){for(var i=0;i<parsedTemplates.length;i++){templates.push(parsedTemplates[i])}docLoaded()};var getLoading=function(){var loading=$j(info).find(load);if(loading.length==0){loading=$j(info).append(jive.fbldr.soy.load()).find(load)}return loading};var updateProgress=function(value){var $progressbar=$j(info).find(prog);$progressbar.find(".fbldr-progress-text").html(value+"%");return $progressbar.progressbar({value:value})};var hideLoading=function(){getLoading().hide()};var showLoading=function(){getLoading().show()};var showMenu=function(){$j(menu+"-create").show();$j(menu+"-help").show();$j(menu+"-forms").hide();$j(menu).fadeIn()};return{loadTemplates:loadTemplates}};jive.fbldr.FakeTemplateSource=function(options){var onLoad=options.onLoad;var abcTemplate={category:"My Templates",name:"ABC Template",desc:"This is a template that I use to record stuff.",fields:[{type:"userpicker",id:"who",label:"Who",required:true},{type:"text",id:"what",label:"What",value:"this is what"},{type:"text",id:"why",label:"Why",value:"this is why"},{type:"text",id:"where",label:"Where",value:"this is where"},{type:"date",id:"when",label:"When",title:"Pick a date, any date."},{type:"textarea",id:"how",label:"How",value:"this is how"},{type:"text",id:"quantity",label:"How Many",value:"this is how many",title:"Must be a number",patterns:["\\d+"]},{type:"boolean",id:"like",label:"Like",value:true}],content:{type:"document",title:"A {$what} is Happening",body:"&lt;body&gt;&lt;div&gt;&lt;h4&gt;For&lt;/h4&gt;{$who}&lt;/div&gt;&lt;div&gt;&lt;h4&gt;{$why.label}&lt;/h4&gt;&lt;span&gt;{$why}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;{$where.label}&lt;/h4&gt;&lt;span&gt;{$where}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;{$when.label}&lt;/h4&gt;&lt;span&gt;{$when}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;{$how.label}&lt;/h4&gt;&lt;span&gt;{$how}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;Liked?&lt;/h4&gt;&lt;span&gt;{$like}&lt;/span&gt;&lt;/div&gt;&lt;/body&gt;"}};var myTemplate={category:"My Templates",name:"A Template",desc:"This is a template that I use to do stuff.",fields:[{type:"text",id:"firstName",label:"First Name",required:true},{type:"text",id:"lastName",label:"Last Name",required:true},{type:"text",id:"email",label:"Email"},{type:"text",id:"phone",label:"Phone"},{type:"text",id:"ipaddr",label:"IP Address",title:"A valid IP address (ex: 192.168.1.1)",patterns:["\\d{1,4}\\.\\d{1,4}\\.\\d{1,4}\\.\\d{1,4}"],patternError:"valid IP address"},{type:"select",id:"contact",label:"Best Contact",values:[{value:"immediately",label:"Now"},{value:"soon",label:"Later"},{value:"future",label:"Never"}],value:"future"},{type:"textarea",id:"notes",label:"Notes"}],content:{type:"discussion",title:"A Discussion Title",body:"&lt;body&gt;Discussion Body&lt;/body&gt;"}};var yourTemplate={category:"Your Templates",name:"Message Template",desc:"This is a template that I use to message stuff.",fields:[{type:"text",id:"msgTo",label:"To",required:true,title:"Who are you sending this to?"},{type:"text",id:"msgFrom",label:"From",required:true,title:"This should be you."},{type:"userselect",id:"msgCopy",label:"CC",required:true,values:[{value:"3218,3378",label:"Developers"},{value:"3218",label:"Fernando"},{value:"3378",label:"Monte"}]},{type:"text",id:"msgSubj",label:"Subject",required:true,title:"What is this regarding?"},{type:"textarea",id:"msgBody",label:"Message",title:"This is the body of your message."},{type:"select",id:"msgSend",label:"Send Via",values:["Email","IM","Text"],required:true}],content:{type:"question",title:"A Question",body:"&lt;body&gt;Question Body&lt;/body&gt;"}};var errorTemplate={category:"Your Templates",name:"Error Template",fields:[{type:"invalid",id:"invalidType",label:"Invalid Type"},{id:"missingType",label:"Missing Type"},{type:"text",label:"Missing ID"},{type:"text",id:"missingLabel"}],content:{}};var loadTemplates=function(){if(onLoad){onLoad([abcTemplate,myTemplate,yourTemplate,errorTemplate])}else{console.log("Error: no onLoad callback specified for template source")}};return{loadTemplates:loadTemplates}};jive.fbldr.TemplateValidator=function(template,onLoad){var structure={template:{required:["category","name","desc","fields","content"],optional:["defaultCategory"]},field:{required:["type","id","label"],optional:["required","patterns","patternError","title","value","values"]},value:{required:["value","label"],optional:[]},content:{required:["type"],optional:["docId","title","body","includeAttachment"]},contentBody:{required:["type","title","body"],optional:["includeAttachment"]}};var validContentTypes=["document","discussion","question"];var validFieldTypes=["boolean","date","select","text","textarea","userpicker","userselect"];var self=this;var valid=false;var errors=[];var isValid=function(){return errors.length==0};var getValidationErrors=function(){return errors};var init=function(){validateTemplate();validateFields();validateContent()};var validateTemplate=function(){if(!template.category&&template.defaultCategory){template.category=template.defaultCategory}validateStructure(template,"template")};var validateFields=function(){if(!template.fields){return}var fields=template.fields;if(!$j.isArray(fields)){var objType=Object.prototype.toString.call(fields);errors.push("Expected array of fields but found '"+objType+"' instead");return}else{if(fields.length==0){errors.push("No fields are defined for template, at least one is required");return}}for(var i=0;i<fields.length;i++){var field=fields[i];validateStructure(field,"field");validateFieldType(field);normalizeRequired(field);validatePatterns(field);normalizeValues(field)}};var validateFieldType=function(field){if(!field.type){return}var type=field.type;if($j.inArray(type,validFieldTypes)<0){errors.push("Invalid field type '"+type+"' specified for field '"+field.id+"'")}};var normalizeRequired=function(field){field.required=field.required&&(field.required==true||field.required=="true")};var validatePatterns=function(field){if(!field.patterns){return}if(!$j.isArray(field.patterns)){var objType=Object.prototype.toString.call(values);errors.push("Expected array of string patterns but found '"+objType+"' instead");return}};var normalizeValues=function(field){if(!field.values){return}var values=field.values;if(!$j.isArray(values)){var objType=Object.prototype.toString.call(values);errors.push("Expected array of values but found '"+objType+"' instead");return}var normalized=[];for(var i=0;i<values.length;i++){var value=values[i];if(typeof(value)=="object"){validateStructure(value,"value");normalized.push(value)}else{normalized.push({value:value,label:value})}}field.values=normalized};var validateContent=function(){if(!template.content){return}validateStructure(template.content,"content");normalizeAttachment();validateContentBody()};var normalizeAttachment=function(){template.content.includeAttachment=template.content.includeAttachment&&(template.content.includeAttachment==true||template.content.includeAttachment=="true")};var validateContentBody=function(){if(!template.content.docId){validateStructure(template.content,"contentBody");normalizeBody();finalizeValidation()}else{var id=parseInt(template.content.docId);if(isNaN(id)||id<=0){errors.push("Unable to load template content body from doc ID '"+template.content.docId+"'");finalizeValidation()}else{loadContentBody()}}};var normalizeBody=function(){if(!template.content.body){return}template.content.body=template.content.body.replace(/&lt;/g,"<").replace(/&gt;/g,">")};var finalizeValidation=function(){validateContentType();if(!isValid()){template.errors=getValidationErrors()}onLoad()};var loadContentBody=function(){var request=osapi.jive.core.documents.get({id:template.content.docId});request.execute(function(response){if(!response.data){errors.push("Unable to load template content body from doc ID '"+template.content.docId+"'")}else{var document=response.data;template.content.title=document.subject;template.content.body=document.content.text}finalizeValidation()})};var validateContentType=function(){if(!template.content.type){return}var type=template.content.type;if($j.inArray(type,validContentTypes)<0){errors.push("Invalid content type '"+type+"' specified")}};var validateStructure=function(object,parent){var required=structure[parent].required;var optional=required.concat(structure[parent].optional);for(var i=0;i<required.length;i++){var child=required[i];if(!object[child]){var msg="Required value of '"+child+"' missing for "+parent;if(object.id){msg+=" '"+object.id+"'"}errors.push(msg)}}for(var child in object){if($j.inArray(child,optional)<0){var msg="Warning: unexpected value of '"+child+"' found for "+parent;if(object.id){msg+=" '"+object.id+"'"}console.log(msg)}}};init();return{isValid:isValid,getValidationErrors:getValidationErrors}};jive.fbldr.UserPicker=function(options){var isMultiple=(options.multiple)?true:false;var field=options.field;var linkId="fbldr-link-"+field.id;var link="#"+linkId;var listId="fbldr-field-"+field.id;var list="#"+listId;var $userList=$j(list);$j(link).click(function(){osapi.jive.core.users.requestPicker({multiple:isMultiple,success:function(response){var users;if($j.isArray(response.data)){users=response.data}else{users=new Array();users.push(response.data)}$j.each(users,function(){var user=this;if(!isInUserList(user)){var $user=$j('<li title="Click to remove user"/>').html('<span class="fbldr-userpicker-remove">[x]</span> '+user.name).attr("userid",user.id).attr("username",user.name);$user.appendTo($userList);$user.click(function(){$j(this).remove()})}})},error:function(error){console.log("An unexpected error has occurred while initializing userpicker")}})});var isInUserList=function(user){var users=$userList.find("li");for(var i=0;i<users.length;i++){if($j(users[i]).attr("userid")==user.id){return true}}return false}};$j(document).ready(function(){$j("#fbldr-menu-create a").click(function(){displayView("create")});$j("#fbldr-menu-help a").click(function(){displayView("help")});$j("#fbldr-menu-forms a").click(function(){displayView("forms")});var displayView=function(displayName){var canvas_view=new gadgets.views.View("canvas");gadgets.views.requestNavigateTo(canvas_view,{display:displayName});return false};var viewParams=gadgets.views.getParams();if(viewParams.display=="create"){var formCreator=new jive.fbldr.FormCreator({})}else{if(viewParams.display=="help"){var formHelp=new jive.fbldr.FormHelp({})}else{var formBuilder=new jive.fbldr.FormBuilder({containerId:"fbldr-main",infoId:"fbldr-info"})}}});if(typeof(gadgets)!="undefined"){gadgets.util.registerOnLoadHandler(function(){})};